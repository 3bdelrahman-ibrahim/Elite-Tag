<!DOCTYPE html>
<html>
  <head>
    <title>Send Message with Location</title>
    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyABa_88lCPYb9G7C2L350H52UvQGdjNYck",
        appId: "1:507527578334:web:bdb82580e01375de11384f",
        messagingSenderId: "507527578334",
        projectId: "elite-tag-1",
        authDomain: "elite-tag-1.firebaseapp.com",
        storageBucket: "elite-tag-1.appspot.com",
        measurementId: "G-CMZ9Z2TCLM",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const latitude = position.coords.latitude;
              const longitude = position.coords.longitude;
              document.getElementById(
                "location"
              ).value = `${latitude}, ${longitude}`;
            },
            (error) => {
              console.error("Error getting location", error);
              alert("Error getting location: " + error.message);
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      async function sendMessage() {
        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const location = document.getElementById("location").value;
        const message = document.getElementById("message").value;

        try {
          await addDoc(collection(db, "messages"), {
            name: name,
            phone: phone,
            location: location,
            message: message,
            timestamp: serverTimestamp(),
          });
          alert("Message sent successfully!");
        } catch (error) {
          console.error("Error sending message", error);
          alert("Failed to send message");
        }
      }
    </script>
  </head>
  <body>
    <h1>Send Message with Location</h1>
    <form id="messageForm">
      <label for="name">Name:</label><br />
      <input type="text" id="name" name="name" /><br /><br />
      <label for="phone">Phone:</label><br />
      <input type="tel" id="phone" name="phone" /><br /><br />
      <label for="message">Message:</label><br />
      <textarea id="message" name="message"></textarea><br /><br />
      <button type="button" onclick="getLocation()">Get Location</button
      ><br /><br />
      <label for="location">Location:</label><br />
      <input type="text" id="location" name="location" readonly /><br /><br />
      <button type="button" onclick="sendMessage()">Send Message</button>
    </form>
  </body>
</html>
